---
import { getEntry, render } from "astro:content";
// const { slug } = Astro.props;
import { Toc } from "../react/Toc"
import { validateToc } from "../../../service/post/utils/tocValidator"
import type { TocNode } from "../../../service/post/types/TocGenrator";
import type { TocProps } from "../../types/TocProps";
import { collectTocIds } from "../../utils/collectTocIds";
import { flattenToc } from "../../utils/flattenToc";


let slug = 'neural-network-visualization-1';
const entry = await getEntry('posts', slug)
const validatedToc: TocNode[] | null = validateToc(entry?.data.toc)


if(!validatedToc) return null;
  
const tocProps: TocProps = {
  idList: collectTocIds(validatedToc),
  flattenToc: flattenToc(validatedToc)
}

const { Content } = await render(entry);
// flattenToc, collectionIds를 props로 내리기
---
<Content />
<Toc {...tocProps} client:load/>